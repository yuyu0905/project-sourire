import{S as u}from"./sweetalert2.all-e1e7afba.js";import{P as T}from"./PaginationComponent-162f3f16.js";import{M as E}from"./modal-f03615f4.js";import{_ as k,r as _,o as a,d,e,h as i,k as I,j as c,v as b,F as V,p as w,I as g,K as M,t as P}from"./index-340e173e.js";import{D as L}from"./DelModal-4cf82a01.js";import{_ as A}from"./logo-lg-92d4c36a.js";const{VITE_API:D,VITE_APIPATH:F}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"project-sourire-api",BASE_URL:"/project-sourire/",MODE:"production",DEV:!1,PROD:!0},B={props:["tempProduct","operateType"],emits:["saveProduct"],data(){return{productModal:""}},methods:{createImagesUrl(){this.innerProduct.imagesUrl||(this.innerProduct.imagesUrl=[]),this.innerProduct.imagesUrl.push("")},deleteImagesUrl(){this.innerProduct.imagesUrl.pop()},showModal(){this.productModal.show()},hideModal(){this.productModal.hide()},uploadFile(){const l=new FormData;l.append("file-to-upload",this.$refs.fileInput.files[0]);const t=`${D}/api/${F}/admin/upload`;u.fire({title:"上傳圖片中",timer:2e3,timerProgressBar:!0,didOpen:()=>{u.showLoading()},willClose:()=>{this.$http.post(t,l,{headers:{"Content-Type":"multipart/form-data"}}).then(r=>{r.data.success&&(this.innerProduct.imageUrl=r.data.imageUrl),this.$refs.fileInput.value=""}).catch(r=>{u.fire({icon:"error",title:r.response.data.message}),this.$refs.fileInput.value=""})}})}},mounted(){this.productModal=new E(this.$refs.productModal,{keyboard:!1})},computed:{innerProduct(){return this.tempProduct}}},S={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},j={class:"modal-dialog modal-xl"},q={class:"modal-content border-0"},H={class:"modal-header bg-gray-dark text-white"},N={id:"productModalLabel",class:"modal-title"},O={key:0},R={key:1},$=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},K={class:"row"},Y={class:"col-sm-4"},G={class:"mb-2"},J={class:"mb-3"},Q=e("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),W={class:"mb-3"},X=e("label",{for:"uploadFile",class:"form-label"},"或 上傳圖片",-1),Z=["src"],ee=e("h3",{class:"mb-3"},"多圖新增",-1),te=e("label",{for:"imagesUrl",class:"form-label"},"圖片網址",-1),se=["onUpdate:modelValue"],oe=["src"],le={key:0},ie={key:1},ae={class:"col-sm-8"},de={class:"mb-3"},re=e("label",{for:"set",class:"form-label"},"系列",-1),ne={class:"mb-3"},ce=e("label",{for:"title",class:"form-label"},"標題",-1),ue={class:"mb-3"},me=e("label",{for:"subTitle",class:"form-label"},"副標題",-1),pe={class:"row"},he={class:"mb-3 col-md-6"},_e=e("label",{for:"category",class:"form-label"},"分類",-1),fe={class:"mb-3 col-md-6"},be=e("label",{for:"price",class:"form-label"},"單位",-1),ge={class:"row"},Pe={class:"mb-3 col-md-6"},ve=e("label",{for:"origin_price",class:"form-label"},"原價",-1),ye={class:"mb-3 col-md-6"},Ue=e("label",{for:"price",class:"form-label"},"售價",-1),Ve=e("hr",null,null,-1),Me={class:"mb-3"},ke=e("label",{for:"description",class:"form-label"},"產品描述",-1),Ie={class:"mb-3"},we=e("label",{for:"content",class:"form-label"},"說明內容",-1),xe={class:"mb-3"},Ce={class:"form-check"},Te=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Ee={class:"mb-3"},Le={class:"form-check"},Ae=e("label",{class:"form-check-label",for:"is_limited_time"},"是否為期間限定",-1),De=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),e("button",{type:"submit",class:"btn btn-gray-dark"}," 確認 ")],-1);function Fe(l,t,r,x,m,s){const p=_("VField"),h=_("ErrorMessage"),U=_("VForm");return a(),d("div",S,[e("div",j,[e("div",q,[e("div",H,[e("h5",N,[r.operateType==="create"?(a(),d("span",O,"新增產品")):(a(),d("span",R,"編輯產品"))]),$]),i(U,{ref:"form",onSubmit:t[15]||(t[15]=n=>l.$emit("saveProduct",s.innerProduct))},{default:I(({errors:n})=>[e("div",z,[e("div",K,[e("div",Y,[e("div",G,[e("div",J,[Q,c(e("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結",id:"imageUrl","onUpdate:modelValue":t[0]||(t[0]=o=>s.innerProduct.imageUrl=o)},null,512),[[b,s.innerProduct.imageUrl]])]),e("div",W,[X,e("input",{type:"file",id:"uploadFile",class:"form-control",ref:"fileInput",onChange:t[1]||(t[1]=(...o)=>s.uploadFile&&s.uploadFile(...o))},null,544)]),e("img",{class:"img-fluid",src:s.innerProduct.imageUrl},null,8,Z)]),ee,(a(!0),d(V,null,w(s.innerProduct.imagesUrl,(o,f)=>(a(),d("div",{class:"mb-3",key:f},[te,c(e("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結",id:"imagesUrl","onUpdate:modelValue":C=>s.innerProduct.imagesUrl[f]=C},null,8,se),[[b,s.innerProduct.imagesUrl[f]]]),e("img",{class:"img-fluid",src:s.innerProduct.imagesUrl[f]},null,8,oe)]))),128)),!s.innerProduct.imagesUrl||!s.innerProduct.imagesUrl.length||s.innerProduct.imagesUrl[s.innerProduct.imagesUrl.length-1]?(a(),d("div",le,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:t[2]||(t[2]=(...o)=>s.createImagesUrl&&s.createImagesUrl(...o))}," 新增圖片 ")])):(a(),d("div",ie,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm d-block w-100",onClick:t[3]||(t[3]=(...o)=>s.deleteImagesUrl&&s.deleteImagesUrl(...o))}," 刪除圖片 ")]))]),e("div",ae,[e("div",de,[re,c(e("input",{id:"set",type:"text",class:"form-control",placeholder:"請輸入系列","onUpdate:modelValue":t[4]||(t[4]=o=>s.innerProduct.set=o)},null,512),[[b,s.innerProduct.set]])]),e("div",ne,[ce,i(p,{id:"title",name:"標題",type:"text",class:g(["form-control",{"is-invalid":n.標題}]),placeholder:"請輸入標題",rules:"required",modelValue:s.innerProduct.title,"onUpdate:modelValue":t[5]||(t[5]=o=>s.innerProduct.title=o)},null,8,["class","modelValue"]),i(h,{name:"標題",class:"invalid-feedback"})]),e("div",ue,[me,c(e("input",{id:"subTitle",type:"text",class:"form-control",placeholder:"請輸入副標題","onUpdate:modelValue":t[6]||(t[6]=o=>s.innerProduct.subTitle=o)},null,512),[[b,s.innerProduct.subTitle]])]),e("div",pe,[e("div",he,[_e,i(p,{id:"category",name:"分類",type:"text",class:g(["form-control",{"is-invalid":n.分類}]),placeholder:"請輸入分類",rules:"required",modelValue:s.innerProduct.category,"onUpdate:modelValue":t[7]||(t[7]=o=>s.innerProduct.category=o)},null,8,["class","modelValue"]),i(h,{name:"分類",class:"invalid-feedback"})]),e("div",fe,[be,i(p,{id:"unit",name:"單位",type:"text",class:g(["form-control",{"is-invalid":n.單位}]),placeholder:"請輸入單位",rules:"required",modelValue:s.innerProduct.unit,"onUpdate:modelValue":t[8]||(t[8]=o=>s.innerProduct.unit=o)},null,8,["class","modelValue"]),i(h,{name:"單位",class:"invalid-feedback"})])]),e("div",ge,[e("div",Pe,[ve,i(p,{id:"origin_price",name:"原價",type:"number",class:g(["form-control",{"is-invalid":n.原價}]),placeholder:"請輸入原價",min:"0",rules:"required|min_value:0|numeric|integer",modelValue:s.innerProduct.origin_price,"onUpdate:modelValue":t[9]||(t[9]=o=>s.innerProduct.origin_price=o),modelModifiers:{number:!0}},null,8,["class","modelValue"]),i(h,{name:"原價",class:"invalid-feedback"})]),e("div",ye,[Ue,i(p,{id:"price",name:"售價",type:"number",class:g(["form-control",{"is-invalid":n.售價}]),placeholder:"請輸入售價",min:"0",rules:"required|min_value:0|numeric|integer",modelValue:s.innerProduct.price,"onUpdate:modelValue":t[10]||(t[10]=o=>s.innerProduct.price=o),modelModifiers:{number:!0}},null,8,["class","modelValue"]),i(h,{name:"售價",class:"invalid-feedback"})])]),Ve,e("div",Me,[ke,c(e("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":t[11]||(t[11]=o=>s.innerProduct.description=o)},`\r
                      `,512),[[b,s.innerProduct.description]])]),e("div",Ie,[we,c(e("textarea",{id:"content",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":t[12]||(t[12]=o=>s.innerProduct.content=o)},`\r
                      `,512),[[b,s.innerProduct.content]])]),e("div",xe,[e("div",Ce,[c(e("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[13]||(t[13]=o=>s.innerProduct.is_enabled=o)},null,512),[[M,s.innerProduct.is_enabled]]),Te])]),e("div",Ee,[e("div",Le,[c(e("input",{id:"is_limited_time",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[14]||(t[14]=o=>s.innerProduct.is_limited_time=o)},null,512),[[M,s.innerProduct.is_limited_time]]),Ae])])])])]),De]),_:1},512)])])],512)}const Be=k(B,[["render",Fe]]),{VITE_API:v,VITE_APIPATH:y}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"project-sourire-api",BASE_URL:"/project-sourire/",MODE:"production",DEV:!1,PROD:!0},Se={data(){return{isLoading:!1,products:[],operateType:"",tempProduct:{imagesUrl:[]},pagination:{},pageNum:1}},methods:{getProducts(l=1){this.isLoading=!0,this.pageNum=l,this.$http.get(`${v}/api/${y}/admin/products?page=${l}`).then(t=>{this.products=t.data.products,this.pagination=t.data.pagination,this.isLoading=!1}).catch(t=>{u.fire({icon:"error",title:t.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},saveProduct(l){this.isLoading=!0;let t=`${v}/api/${y}/admin/product`;this.operateType==="modify"&&(t=`${v}/api/${y}/admin/product/${l.id}`),this.$http[this.operateType==="create"?"post":"put"](`${t}`,{data:l}).then(r=>{this.$refs.productModal.hideModal(),u.fire({icon:"success",title:r.data.message,showConfirmButton:!1,timer:1500}),this.getProducts(this.pageNum),this.isLoading=!1}).catch(r=>{u.fire({icon:"error",title:r.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},deleteProduct(){this.isLoading=!0,this.$http.delete(`${v}/api/${y}/admin/product/${this.tempProduct.id}`,{data:this.tempProduct}).then(l=>{this.$refs.delModal.hideModal(),u.fire({icon:"success",title:l.data.message,showConfirmButton:!1,timer:1500}),this.getProducts(this.pageNum),this.isLoading=!1}).catch(l=>{u.fire({icon:"error",title:l.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},openModal(l,t){this.operateType=l,l==="create"?(this.tempProduct={imagesUrl:[]},this.$refs.productModal.showModal()):l==="modify"?(this.tempProduct={...t},this.$refs.productModal.showModal()):l==="delete"&&(this.tempProduct={...t},this.$refs.delModal.showModal())}},components:{PaginationComponent:T,ProductModal:Be,DelModal:L},mounted(){this.getProducts()}},je=e("img",{class:"img-fluid loading-img animate__animated animate__shakeY",src:A,alt:"logo"},null,-1),qe={class:"container"},He={class:"text-end mt-4"},Ne={class:"table table-hover mt-4"},Oe=e("thead",null,[e("tr",null,[e("th",{width:"120"}," 分類 "),e("th",null,"產品名稱"),e("th",{width:"120"}," 原價 "),e("th",{width:"120"}," 售價 "),e("th",{width:"100"}," 是否啟用 "),e("th",{width:"120"}," 編輯 ")])],-1),Re={class:"text-end"},$e={class:"text-end"},ze={key:0,class:"text-success"},Ke={key:1},Ye={class:"btn-group"},Ge=["onClick"],Je=["onClick"];function Qe(l,t,r,x,m,s){const p=_("VueLoading"),h=_("PaginationComponent"),U=_("ProductModal"),n=_("DelModal");return a(),d(V,null,[i(p,{active:m.isLoading},{default:I(()=>[je]),_:1},8,["active"]),e("div",qe,[e("div",He,[e("button",{type:"button",class:"btn btn-gray-dark",onClick:t[0]||(t[0]=o=>s.openModal("create"))}," 建立新的產品 ")]),e("table",Ne,[Oe,e("tbody",null,[(a(!0),d(V,null,w(m.products,o=>(a(),d("tr",{key:o.id},[e("td",null,P(o.category),1),e("td",null,P(o.set+o.title),1),e("td",Re,P(o.origin_price),1),e("td",$e,P(o.price),1),e("td",null,[o.is_enabled?(a(),d("span",ze,"啟用")):(a(),d("span",Ke,"未啟用"))]),e("td",null,[e("div",Ye,[e("button",{type:"button",class:"btn btn-outline-gray-dark btn-sm",onClick:f=>s.openModal("modify",o)}," 編輯 ",8,Ge),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:f=>s.openModal("delete",o)}," 刪除 ",8,Je)])])]))),128))])]),i(h,{pagination:m.pagination,onChangePage:s.getProducts},null,8,["pagination","onChangePage"])]),i(U,{ref:"productModal","temp-product":m.tempProduct,"operate-type":m.operateType,onSaveProduct:s.saveProduct},null,8,["temp-product","operate-type","onSaveProduct"]),i(n,{ref:"delModal","temp-item":m.tempProduct,onDeleteItem:s.deleteProduct},null,8,["temp-item","onDeleteItem"])],64)}const ot=k(Se,[["render",Qe]]);export{ot as default};
