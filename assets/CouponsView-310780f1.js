import{S as h}from"./sweetalert2.all-e1e7afba.js";import{P as $}from"./PaginationComponent-162f3f16.js";import{M as L}from"./modal-f03615f4.js";import{_ as k,r as u,o as d,d as r,h as a,k as M,e,I as _,j as T,K as D,F as y,p as x,t as f}from"./index-340e173e.js";import{_ as V}from"./logo-lg-92d4c36a.js";import{D as I}from"./DelModal-4cf82a01.js";const P={props:["tempCoupon","operateType"],emits:["saveCoupon"],data(){return{isLoading:!1,couponModal:"",due_date:"",innerCoupon:{}}},methods:{showModal(){this.couponModal.show()},hideModal(){this.couponModal.hide()},ltToday(t){const[o]=new Date().toISOString().split("T");return t>=o||this.innerCoupon.id?!0:"到期日 不可小於今日"}},mounted(){this.couponModal=new L(this.$refs.couponModal,{keyboard:!1})},watch:{tempCoupon(){this.innerCoupon=this.tempCoupon;const t=new Date(this.innerCoupon.due_date*1e3).toISOString().split("T");Array.isArray(t)&&([this.due_date]=t)},due_date(){this.innerCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}}},S=e("img",{class:"img-fluid loading-img animate__animated animate__shakeY",src:V,alt:"logo"},null,-1),A={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},E={class:"modal-dialog"},B={class:"modal-content border-0"},F={class:"modal-header bg-gray-dark text-white"},U={id:"couponModalLabel",class:"modal-title"},N={key:0},O={key:1},j=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},H={class:"mb-3"},R=e("label",{for:"title"},"標題",-1),Y={class:"mb-3"},z=e("label",{for:"code"},"優惠碼",-1),K={class:"mb-3"},G=e("label",{for:"due_date"},"到期日",-1),J={class:"mb-3"},Q=e("label",{for:"price"},"折扣百分比",-1),W={class:"mb-3"},X={class:"form-check"},Z=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),ee=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),e("button",{type:"submit",class:"btn btn-gray-dark"}," 確認 ")],-1);function oe(t,o,p,w,n,l){const C=u("VueLoading"),c=u("VField"),m=u("ErrorMessage"),v=u("VForm");return d(),r(y,null,[a(C,{active:n.isLoading},{default:M(()=>[S]),_:1},8,["active"]),e("div",A,[e("div",E,[e("div",B,[e("div",F,[e("h5",U,[p.operateType==="create"?(d(),r("span",N,"新增優惠卷")):(d(),r("span",O,"編輯優惠卷"))]),j]),a(v,{ref:"form",onSubmit:o[5]||(o[5]=s=>t.$emit("saveCoupon",n.innerCoupon))},{default:M(({errors:s})=>[e("div",q,[e("div",H,[R,a(c,{id:"title",name:"標題",type:"text",class:_(["form-control",{"is-invalid":s.標題}]),placeholder:"請輸入標題",rules:"required",modelValue:n.innerCoupon.title,"onUpdate:modelValue":o[0]||(o[0]=i=>n.innerCoupon.title=i)},null,8,["class","modelValue"]),a(m,{name:"標題",class:"invalid-feedback"})]),e("div",Y,[z,a(c,{id:"code",name:"優惠碼",type:"text",class:_(["form-control",{"is-invalid":s.優惠碼}]),placeholder:"請輸入優惠碼",rules:"required",modelValue:n.innerCoupon.code,"onUpdate:modelValue":o[1]||(o[1]=i=>n.innerCoupon.code=i)},null,8,["class","modelValue"]),a(m,{name:"優惠碼",class:"invalid-feedback"})]),e("div",K,[G,a(c,{id:"due_date",name:"到期日",type:"date",class:_(["form-control",{"is-invalid":s.到期日}]),placeholder:"請輸入到期日",rules:l.ltToday,modelValue:n.due_date,"onUpdate:modelValue":o[2]||(o[2]=i=>n.due_date=i)},null,8,["class","rules","modelValue"]),a(m,{name:"到期日",class:"invalid-feedback"})]),e("div",J,[Q,a(c,{id:"price",name:"折扣百分比",type:"number",class:_(["form-control",{"is-invalid":s.折扣百分比}]),placeholder:"請輸入折扣百分比",rules:"required|min_value:0|max_value:100|numeric|integer",modelValue:n.innerCoupon.percent,"onUpdate:modelValue":o[3]||(o[3]=i=>n.innerCoupon.percent=i),modelModifiers:{number:!0},min:"0",max:"100"},null,8,["class","modelValue"]),a(m,{name:"折扣百分比",class:"invalid-feedback"})]),e("div",W,[e("div",X,[T(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=i=>n.innerCoupon.is_enabled=i),id:"is_enabled"},null,512),[[D,n.innerCoupon.is_enabled]]),Z])])]),ee]),_:1},512)])])],512)],64)}const te=k(P,[["render",oe]]),{VITE_API:g,VITE_APIPATH:b}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"project-sourire-api",BASE_URL:"/project-sourire/",MODE:"production",DEV:!1,PROD:!0},ne={data(){return{isLoading:!1,coupons:[],operateType:"",tempCoupon:{},pagination:{},pageNum:1}},methods:{getCoupons(t=1){this.isLoading=!0,this.pageNum=t,this.$http.get(`${g}/api/${b}/admin/coupons?page=${t}`).then(o=>{this.coupons=o.data.coupons,this.pagination=o.data.pagination,this.isLoading=!1}).catch(o=>{h.fire({icon:"error",title:o.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},saveCoupon(t){this.isLoading=!0;let o=`${g}/api/${b}/admin/coupon`;this.operateType==="modify"&&(o=`${g}/api/${b}/admin/coupon/${t.id}`),this.$http[this.operateType==="create"?"post":"put"](`${o}`,{data:t}).then(p=>{this.$refs.couponModal.hideModal(),h.fire({icon:"success",title:p.data.message,showConfirmButton:!1,timer:1500}),this.getCoupons(this.pageNum),this.isLoading=!1}).catch(p=>{h.fire({icon:"error",title:p.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},deleteCoupon(){this.isLoading=!0,this.$http.delete(`${g}/api/${b}/admin/coupon/${this.tempCoupon.id}`,{data:this.tempCoupon}).then(t=>{this.$refs.delModal.hideModal(),h.fire({icon:"success",title:t.data.message,showConfirmButton:!1,timer:1500}),this.getCoupons(this.pageNum),this.isLoading=!1}).catch(t=>{h.fire({icon:"error",title:t.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},openModal(t,o){this.operateType=t,t==="create"?(this.tempCoupon={is_enabled:0,due_date:new Date().getTime()/1e3},this.$refs.couponModal.showModal()):t==="modify"?(this.tempCoupon={...o},this.$refs.couponModal.showModal()):t==="delete"&&(this.tempCoupon={...o},this.$refs.delModal.showModal())}},components:{PaginationComponent:$,CouponModal:te,DelModal:I},mounted(){this.getCoupons()}},se=e("img",{class:"img-fluid loading-img animate__animated animate__shakeY",src:V,alt:"logo"},null,-1),ae={class:"container"},ie={class:"text-end mt-4"},le={class:"table table-hover mt-4"},de=e("thead",null,[e("tr",null,[e("th",{width:"120"},"標題"),e("th",null,"優惠碼"),e("th",null,"折扣百分比"),e("th",{width:"120"}," 到期日 "),e("th",{width:"120"}," 是否啟用 "),e("th",{width:"120"}," 編輯 ")])],-1),re={key:0,class:"text-success"},ue={key:1},pe={class:"btn-group"},ce=["onClick"],me=["onClick"];function he(t,o,p,w,n,l){const C=u("VueLoading"),c=u("PaginationComponent"),m=u("CouponModal"),v=u("DelModal");return d(),r(y,null,[a(C,{active:n.isLoading},{default:M(()=>[se]),_:1},8,["active"]),e("div",ae,[e("div",ie,[e("button",{type:"button",class:"btn btn-gray-dark",onClick:o[0]||(o[0]=s=>l.openModal("create"))}," 建立新的優惠券 ")]),e("table",le,[de,e("tbody",null,[(d(!0),r(y,null,x(n.coupons,s=>(d(),r("tr",{key:s.id},[e("td",null,f(s.title),1),e("td",null,f(s.code),1),e("td",null,f(`${s.percent} %`),1),e("td",null,f(t.$dateFormat.date(s.due_date)),1),e("td",null,[s.is_enabled?(d(),r("span",re,"啟用")):(d(),r("span",ue,"未啟用"))]),e("td",null,[e("div",pe,[e("button",{type:"button",class:"btn btn-outline-gray-dark btn-sm",onClick:i=>l.openModal("modify",s)}," 編輯 ",8,ce),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>l.openModal("delete",s)}," 刪除 ",8,me)])])]))),128))])]),a(c,{pagination:n.pagination,onChangePage:l.getCoupons},null,8,["pagination","onChangePage"])]),a(m,{ref:"couponModal","temp-coupon":n.tempCoupon,"operate-type":n.operateType,onSaveCoupon:l.saveCoupon},null,8,["temp-coupon","operate-type","onSaveCoupon"]),a(v,{ref:"delModal","temp-item":n.tempCoupon,onDeleteItem:l.deleteCoupon},null,8,["temp-item","onDeleteItem"])],64)}const Me=k(ne,[["render",he]]);export{Me as default};
