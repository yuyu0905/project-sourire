import{S as h}from"./sweetalert2.all-0b553f6e.js";import{P}from"./PaginationComponent-248fa8bd.js";import{M as x}from"./modal-4edad9d3.js";import{_ as O,r as _,o,d as l,h as u,k as y,e,t as a,f as V,F as m,p as b,j as k,K as M,I as D}from"./index-0c62bcd8.js";import{_ as v}from"./logo-lg-92d4c36a.js";import{D as I}from"./DelModal-f23d5a80.js";const E={props:["tempOrder"],emits:["updatePaid"],data(){return{isLoading:!1,orderModal:""}},methods:{showModal(){this.orderModal.show()},hideModal(){this.orderModal.hide()}},mounted(){this.orderModal=new x(this.$refs.orderModal,{keyboard:!1})},computed:{innerOrder(){return this.tempOrder}}},B=e("img",{class:"img-fluid loading-img animate__animated animate__shakeY",src:v,alt:"logo"},null,-1),A={id:"orderModal",ref:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},N={class:"modal-dialog modal-xl"},T={class:"modal-content border-0"},U=e("div",{class:"modal-header bg-gray-dark text-white"},[e("h5",{id:"orderModalLabel",class:"modal-title"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),j={class:"modal-body"},F={class:"row"},S={class:"col-md-4"},q=e("h3",null,"用戶資料",-1),H={class:"table"},R={key:0},Y=e("th",{style:{width:"100px"}},"姓名",-1),z=e("th",null,"Email",-1),K=e("th",null,"電話",-1),G=e("th",null,"地址",-1),J={class:"col-md-8"},Q=e("h3",null,"訂單細節",-1),W={class:"table"},X=e("th",{style:{width:"100px"}},"訂單編號",-1),Z=e("th",null,"下單時間",-1),ee=e("th",null,"付款狀態",-1),te={key:0,class:"text-success"},se={key:1,class:"text-muted"},ne=e("th",null,"總金額",-1),ae=e("h3",null,"選購商品",-1),oe={class:"table"},le=e("thead",null,[e("tr")],-1),ie={class:"text-end"},de={class:"d-flex justify-content-end"},re={class:"form-check"},ce={class:"form-check-label",for:"flexCheckDefault"},he={key:0},_e={key:1},ue={class:"modal-footer"},me=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function pe(s,n,C,$,c,t){const p=_("VueLoading");return o(),l(m,null,[u(p,{active:c.isLoading},{default:y(()=>[B]),_:1},8,["active"]),e("div",A,[e("div",N,[e("div",T,[U,e("div",j,[e("div",F,[e("div",S,[q,e("table",H,[t.innerOrder.user?(o(),l("tbody",R,[e("tr",null,[Y,e("td",null,a(t.innerOrder.user.name),1)]),e("tr",null,[z,e("td",null,a(t.innerOrder.user.email),1)]),e("tr",null,[K,e("td",null,a(t.innerOrder.user.tel),1)]),e("tr",null,[G,e("td",null,a(t.innerOrder.user.address),1)])])):V("",!0)])]),e("div",J,[Q,e("table",W,[e("tbody",null,[e("tr",null,[X,e("td",null,a(t.innerOrder.id),1)]),e("tr",null,[Z,e("td",null,a(s.$dateFormat.date(t.innerOrder.create_at)),1)]),e("tr",null,[ee,e("td",null,[t.innerOrder.is_paid?(o(),l("strong",te,"已付款")):(o(),l("span",se,"尚未付款"))])]),e("tr",null,[ne,e("td",null,a(t.innerOrder.total),1)])])]),ae,e("table",oe,[le,e("tbody",null,[(o(!0),l(m,null,b(t.innerOrder.products,d=>(o(),l("tr",{key:d.id},[e("th",null,a(d.product.title),1),e("td",null,a(d.qty)+" / "+a(d.product.unit),1),e("td",ie,a(d.final_total),1)]))),128))])]),e("div",de,[e("div",re,[k(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":n[0]||(n[0]=d=>t.innerOrder.is_paid=d)},null,512),[[M,t.innerOrder.is_paid]]),e("label",ce,[t.innerOrder.is_paid?(o(),l("span",he,"已付款")):(o(),l("span",_e,"未付款"))])])])])])]),e("div",ue,[me,e("button",{type:"button",class:"btn btn-gray-dark",onClick:n[1]||(n[1]=d=>s.$emit("updatePaid",t.innerOrder))}," 修改付費狀態 ")])])])],512)],64)}const fe=O(E,[["render",pe]]),{VITE_API:f,VITE_APIPATH:g}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"project-sourire-api",BASE_URL:"/project-sourire/",MODE:"production",DEV:!1,PROD:!0},ge={data(){return{isLoading:!1,orders:[],operateType:"",tempOrder:{},pagination:{},pageNum:1}},methods:{getOrders(s=1){this.isLoading=!0,this.pageNum=s,this.$http.get(`${f}/api/${g}/admin/orders?page=${s}`).then(n=>{this.orders=n.data.orders,this.pagination=n.data.pagination,this.isLoading=!1}).catch(n=>{h.fire({icon:"error",title:n.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},updatePaid(s){this.isLoading=!0,this.$http.put(`${f}/api/${g}/admin/order/${s.id}`,{data:{is_paid:s.is_paid}}).then(n=>{this.$refs.orderModal.hideModal(),h.fire({icon:"success",title:n.data.message,showConfirmButton:!1,timer:1500}),this.getOrders(this.pageNum),this.isLoading=!1}).catch(n=>{h.fire({icon:"error",title:n.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},deleteOrder(){this.isLoading=!0,this.$http.delete(`${f}/api/${g}/admin/order/${this.tempOrder.id}`,{data:this.tempOrder}).then(s=>{this.$refs.delModal.hideModal(),h.fire({icon:"success",title:s.data.message,showConfirmButton:!1,timer:1500}),this.getOrders(this.pageNum),this.isLoading=!1}).catch(s=>{h.fire({icon:"error",title:s.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},openModal(s,n){this.operateType=s,s==="view"?(this.tempOrder={...n},this.$refs.orderModal.showModal()):s==="delete"&&(this.tempOrder={...n},this.$refs.delModal.showModal())}},components:{PaginationComponent:P,OrderModal:fe,DelModal:I},mounted(){this.getOrders()}},be=e("img",{class:"img-fluid loading-img animate__animated animate__shakeY",src:v,alt:"logo"},null,-1),Oe={class:"container"},ye={class:"mt-4"},ke={class:"table table-hover align-middle"},Me=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),ve={class:"list-unstyled"},Ce={class:"text-end"},$e={class:"form-check form-switch"},we=["id","onUpdate:modelValue","onChange"],Le=["for"],Pe={key:0},xe={key:1},Ve={class:"btn-group"},De=["onClick"],Ie=["onClick"];function Ee(s,n,C,$,c,t){const p=_("VueLoading"),d=_("PaginationComponent"),w=_("OrderModal"),L=_("DelModal");return o(),l(m,null,[u(p,{active:c.isLoading},{default:y(()=>[be]),_:1},8,["active"]),e("div",Oe,[e("div",ye,[e("table",ke,[Me,e("tbody",null,[(o(!0),l(m,null,b(c.orders,i=>(o(),l("tr",{key:i.id,class:D({"text-secondary":!i.is_paid})},[e("td",null,a(s.$dateFormat.date(i.create_at)),1),e("td",null,a(i.user.email),1),e("td",null,[e("ul",ve,[(o(!0),l(m,null,b(i.products,r=>(o(),l("li",{key:r.id},a(r.product.title)+" 數量："+a(r.qty)+" "+a(r.product.unit),1))),128))])]),e("td",Ce,a(i.total),1),e("td",null,[e("div",$e,[k(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:i.id,"onUpdate:modelValue":r=>i.is_paid=r,onChange:r=>t.updatePaid(i)},null,40,we),[[M,i.is_paid]]),e("label",{class:"form-check-label",for:i.id},[i.is_paid?(o(),l("span",Pe,"已付款")):(o(),l("span",xe,"未付款"))],8,Le)])]),e("td",null,[e("div",Ve,[e("button",{type:"button",class:"btn btn-outline-gray-dark btn-sm",onClick:r=>t.openModal("view",i)}," 檢視 ",8,De),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>t.openModal("delete",i)}," 刪除 ",8,Ie)])])],2))),128))])]),u(d,{pagination:c.pagination,onChangePage:t.getOrders},null,8,["pagination","onChangePage"])]),u(w,{ref:"orderModal","temp-order":c.tempOrder,onUpdatePaid:t.updatePaid},null,8,["temp-order","onUpdatePaid"]),u(L,{ref:"delModal","temp-item":c.tempOrder,onDeleteItem:t.deleteOrder},null,8,["temp-item","onDeleteItem"])])],64)}const Fe=O(ge,[["render",Ee]]);export{Fe as default};
