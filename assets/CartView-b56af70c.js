import{T as f}from"./toast-77d67ba4.js";import{_ as P,m as L,b as F,r as d,o as r,d as i,h as a,k as _,e as s,f as h,j as b,v as g,i as I,I as c,t as y,F as V,s as N}from"./index-0c62bcd8.js";import{c as v}from"./cart-fee2c670.js";import{C as A}from"./CartList-99855de0.js";import{R as x}from"./RecommendSwiper-4cb8c26e.js";import{_ as U}from"./logo-lg-92d4c36a.js";import"./sweetalert2.all-0b553f6e.js";const{VITE_API:k,VITE_APIPATH:C}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"project-sourire-api",BASE_URL:"/project-sourire/",MODE:"production",DEV:!1,PROD:!0},R={data(){return{isLoading:!1,form:{user:{name:"",email:"",tel:"",address:""},message:""},couponCode:"",loadingItem:""}},components:{CartList:A,RecommendSwiper:x},methods:{...L(v,["getCart"]),createOrder(){this.isLoading=!0,this.$http.post(`${k}/api/${C}/order`,{data:this.form}).then(e=>{this.$refs.form.resetForm(),this.form={user:{name:"",email:"",tel:"",address:""},message:""},this.getCart(),f(e.data.message,"success"),this.$router.push(`pay/${e.data.orderId}`),this.isLoading=!1}).catch(e=>{f(e.response.data.message,"error"),this.isLoading=!1})},addCouponCode(){this.loadingItem=this.couponCode,this.$http.post(`${k}/api/${C}/coupon`,{data:{code:this.couponCode}}).then(e=>{this.getCart(),f(e.data.message,"success"),this.loadingItem=""}).catch(e=>{f(e.response.data.message,"error"),this.loadingItem=""})},isPhone(e){return/^(09)[0-9]{8}$/.test(e)?!0:"需要正確的手機號碼"}},computed:{...F(v,["cart"])}},D=s("img",{class:"img-fluid loading-img animate__animated animate__shakeY",src:U,alt:"logo"},null,-1),j={class:"bg-background py-5 min-height"},B={class:"container"},M={key:0,class:"row row-cols-3 list-unstyled mb-5 text-center"},O=N('<li class="col"><p class="mb-0 bg-gray-dark text-white m-2 p-3">STEP 1<br>建立<br class="d-block d-lg-none">訂單</p></li><li class="col"><p class="mb-0 border border-gray-dark m-2 p-3">STEP 2<br>進行<br class="d-block d-lg-none">結帳</p></li><li class="col"><p class="mb-0 border border-gray-dark m-2 p-3">STEP 3<br>訂單<br class="d-block d-lg-none">完成</p></li>',3),q=[O],H={class:"row"},$={key:0,class:"col-12 col-lg-6 p-5"},z=s("h2",null,"確認訂單內容",-1),Y=s("hr",null,null,-1),G={class:"input-group mb-3 input-group-sm"},J={key:0,type:"text",class:"form-control",placeholder:"已套用優惠券",disabled:""},K={class:"input-group-append"},Q=["disabled"],W={key:0,class:"fas fa-spinner fa-pulse"},X={key:0,class:"fs-5 text-end fw-bold mb-4"},Z={key:1,class:"col-12 col-lg-6 bg-white p-5"},ee=s("h2",null,"訂購資訊",-1),se={class:"mb-3"},oe=s("label",{for:"email",class:"form-label"},"Email",-1),te={class:"mb-3"},ae=s("label",{for:"name",class:"form-label"},"收件人姓名",-1),le={class:"mb-3"},re=s("label",{for:"tel",class:"form-label"},"收件人手機",-1),ie={class:"mb-3"},ne=s("label",{for:"address",class:"form-label"},"收件人地址",-1),de={class:"mb-3"},ce=s("label",{for:"message",class:"form-label"},"留言",-1),me=s("div",{class:"text-end"},[s("button",{type:"submit",class:"btn btn-primary py-3 px-5 text-gray-dark w-100"},"送出訂單")],-1),pe={class:"col-12 d-flex flex-column justify-content-center align-items-center my-5"},ue=s("p",null,[s("i",{class:"fa-solid fa-cart-shopping mb-2 me-2 fs-5"}),I("購物車內沒有商品")],-1);function fe(e,o,he,_e,t,m){const w=d("VueLoading"),E=d("CartList"),p=d("VField"),u=d("ErrorMessage"),T=d("VForm"),S=d("RecommendSwiper");return r(),i(V,null,[a(w,{active:t.isLoading},{default:_(()=>[D]),_:1},8,["active"]),s("main",null,[s("section",j,[s("div",B,[e.cart.carts&&e.cart.carts.length>0?(r(),i("ul",M,q)):h("",!0),s("div",H,[e.cart.carts&&e.cart.carts.length>0?(r(),i("div",$,[z,a(E),Y,s("div",G,[e.cart.final_total!==e.cart.total?(r(),i("input",J)):b((r(),i("input",{key:1,type:"text",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=n=>t.couponCode=n),placeholder:"請輸入優惠券"},null,512)),[[g,t.couponCode]]),s("div",K,[s("button",{class:"btn btn-outline-primary text-gray-dark",disabled:e.cart.final_total!==e.cart.total||t.loadingItem!="",type:"button",onClick:o[1]||(o[1]=(...n)=>m.addCouponCode&&m.addCouponCode(...n))},[t.loadingItem!=""?(r(),i("i",W)):h("",!0),I(" 套用優惠碼 ")],8,Q)])]),s("p",{class:c(["fs-5 text-end fw-bold",e.cart.final_total!==e.cart.total?"text-muted text-decoration-line-through":""])},y(`總計金額：NT$ ${e.$priceFormat.price(e.cart.total)}`),3),e.cart.final_total!==e.cart.total?(r(),i("p",X,y(`折扣後金額：NT$ ${e.$priceFormat.price(e.cart.final_total)}`),1)):h("",!0)])):h("",!0),e.cart.carts&&e.cart.carts.length>0?(r(),i("div",Z,[ee,a(T,{ref:"form",onSubmit:m.createOrder},{default:_(({errors:n})=>[s("div",se,[oe,a(p,{id:"email",name:"email",type:"email",class:c(["form-control",{"is-invalid":n.email}]),placeholder:"請輸入 Email",modelValue:t.form.user.email,"onUpdate:modelValue":o[2]||(o[2]=l=>t.form.user.email=l),rules:"email|required"},null,8,["class","modelValue"]),a(u,{name:"email",class:"invalid-feedback"})]),s("div",te,[ae,a(p,{id:"name",name:"姓名",type:"text",class:c(["form-control",{"is-invalid":n.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:t.form.user.name,"onUpdate:modelValue":o[3]||(o[3]=l=>t.form.user.name=l)},null,8,["class","modelValue"]),a(u,{name:"姓名",class:"invalid-feedback"})]),s("div",le,[re,a(p,{id:"tel",name:"電話",type:"tel",class:c(["form-control",{"is-invalid":n.電話}]),placeholder:"請輸入電話",modelValue:t.form.user.tel,"onUpdate:modelValue":o[4]||(o[4]=l=>t.form.user.tel=l),rules:m.isPhone},null,8,["class","modelValue","rules"]),a(u,{name:"電話",class:"invalid-feedback"})]),s("div",ie,[ne,a(p,{id:"address",name:"地址",type:"text",class:c(["form-control",{"is-invalid":n.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:t.form.user.address,"onUpdate:modelValue":o[5]||(o[5]=l=>t.form.user.address=l)},null,8,["class","modelValue"]),a(u,{name:"地址",class:"invalid-feedback"})]),s("div",de,[ce,b(s("textarea",{id:"message",name:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":o[6]||(o[6]=l=>t.form.message=l)},null,512),[[g,t.form.message]])]),me]),_:1},8,["onSubmit"])])):(r(),i(V,{key:2},[s("div",pe,[ue,s("a",{class:"btn btn-primary py-3 px-5 text-gray-dark",role:"button",onClick:o[7]||(o[7]=()=>e.$router.push("/products"))},"再去晃晃吧")]),a(S)],64))])])])])],64)}const Ie=P(R,[["render",fe]]);export{Ie as default};
