import{T as f}from"./toast-d641e51e.js";import{_ as P,m as L,b as x,r as d,o as r,d as n,h as a,k as _,e,f as h,j as b,v as g,i as I,I as c,t as y,F as V,s as N}from"./index-340e173e.js";import{c as v}from"./cart-08017af5.js";import{C as A}from"./CartList-b8facac7.js";import{R as F}from"./RecommendSwiper-4ee5c3d3.js";import{_ as U}from"./logo-lg-92d4c36a.js";import"./sweetalert2.all-e1e7afba.js";const{VITE_API:k,VITE_APIPATH:C}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"project-sourire-api",BASE_URL:"/project-sourire/",MODE:"production",DEV:!1,PROD:!0},R={data(){return{isLoading:!1,form:{user:{name:"",email:"",tel:"",address:""},message:""},couponCode:"",loadingItem:""}},components:{CartList:A,RecommendSwiper:F},methods:{...L(v,["getCart"]),createOrder(){this.isLoading=!0,this.$http.post(`${k}/api/${C}/order`,{data:this.form}).then(s=>{this.$refs.form.resetForm(),this.form={user:{name:"",email:"",tel:"",address:""},message:""},this.getCart(),f(s.data.message,"success"),this.$router.push(`pay/${s.data.orderId}`),this.isLoading=!1}).catch(s=>{f(s.response.data.message,"error"),this.isLoading=!1})},addCouponCode(){this.loadingItem=this.couponCode,this.$http.post(`${k}/api/${C}/coupon`,{data:{code:this.couponCode}}).then(s=>{this.getCart(),f(s.data.message,"success"),this.loadingItem=""}).catch(s=>{f(s.response.data.message,"error"),this.loadingItem=""})},isPhone(s){return/^(09)[0-9]{8}$/.test(s)?!0:"需要正確的手機號碼"}},computed:{...x(v,["cart"])}},D=e("img",{class:"img-fluid loading-img animate__animated animate__shakeY",src:U,alt:"logo"},null,-1),j={class:"bg-background py-5 min-height"},B={class:"container"},M={key:0,class:"row row-cols-3 list-unstyled mb-5 text-center"},O=N('<li class="col"><p class="mb-0 bg-gray-dark text-white m-2 p-3">STEP 1<br>建立<br class="d-block d-lg-none">訂單</p></li><li class="col"><p class="mb-0 border border-gray-dark m-2 p-3">STEP 2<br>進行<br class="d-block d-lg-none">結帳</p></li><li class="col"><p class="mb-0 border border-gray-dark m-2 p-3">STEP 3<br>訂單<br class="d-block d-lg-none">完成</p></li>',3),q=[O],H={class:"row"},z={key:0,class:"col-12 col-lg-6 p-5"},Y=e("h2",null,"確認訂單內容",-1),G=e("hr",null,null,-1),J={class:"input-group mb-3 input-group-sm"},K={key:0,type:"text",class:"form-control",placeholder:"已套用優惠券",disabled:""},Q={class:"input-group-append"},W=["disabled"],X={key:0,class:"fas fa-spinner fa-pulse"},Z={key:0,class:"fs-5 text-end fw-bold mb-4"},$={key:1,class:"col-12 col-lg-6 bg-white p-5"},ee=e("h2",null,"訂購資訊",-1),se={class:"mb-3"},oe=e("label",{for:"email",class:"form-label"},"Email",-1),te={class:"mb-3"},ae=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),le={class:"mb-3"},re=e("label",{for:"tel",class:"form-label"},"收件人手機",-1),ne={class:"mb-3"},ie=e("label",{for:"address",class:"form-label"},"收件人地址",-1),de={class:"mb-3"},ce=e("label",{for:"message",class:"form-label"},"留言",-1),me=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-primary py-3 px-5 text-gray-dark w-100"},"送出訂單")],-1),ue={class:"col-12 d-flex flex-column justify-content-center align-items-center my-5"},pe=e("p",null,[e("i",{class:"fa-solid fa-cart-shopping mb-2 me-2 fs-5"}),I("購物車內沒有商品")],-1);function fe(s,o,he,_e,t,m){const w=d("VueLoading"),E=d("CartList"),u=d("VField"),p=d("ErrorMessage"),T=d("VForm"),S=d("RecommendSwiper");return r(),n(V,null,[a(w,{active:t.isLoading},{default:_(()=>[D]),_:1},8,["active"]),e("main",null,[e("section",j,[e("div",B,[s.cart.carts&&s.cart.carts.length>0?(r(),n("ul",M,q)):h("",!0),e("div",H,[s.cart.carts&&s.cart.carts.length>0?(r(),n("div",z,[Y,a(E),G,e("div",J,[s.cart.final_total!==s.cart.total?(r(),n("input",K)):b((r(),n("input",{key:1,type:"text",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=i=>t.couponCode=i),placeholder:"請輸入優惠券"},null,512)),[[g,t.couponCode]]),e("div",Q,[e("button",{class:"btn btn-outline-primary text-gray-dark",disabled:s.cart.final_total!==s.cart.total||t.loadingItem!="",type:"button",onClick:o[1]||(o[1]=(...i)=>m.addCouponCode&&m.addCouponCode(...i))},[t.loadingItem!=""?(r(),n("i",X)):h("",!0),I(" 套用優惠碼 ")],8,W)])]),e("p",{class:c(["fs-5 text-end fw-bold",s.cart.final_total!==s.cart.total?"text-muted text-decoration-line-through":""])},y(`總計金額：NT$ ${s.cart.total}`),3),s.cart.final_total!==s.cart.total?(r(),n("p",Z,y(`折扣後金額：NT$ ${s.cart.final_total}`),1)):h("",!0)])):h("",!0),s.cart.carts&&s.cart.carts.length>0?(r(),n("div",$,[ee,a(T,{ref:"form",onSubmit:m.createOrder},{default:_(({errors:i})=>[e("div",se,[oe,a(u,{id:"email",name:"email",type:"email",class:c(["form-control",{"is-invalid":i.email}]),placeholder:"請輸入 Email",modelValue:t.form.user.email,"onUpdate:modelValue":o[2]||(o[2]=l=>t.form.user.email=l),rules:"email|required"},null,8,["class","modelValue"]),a(p,{name:"email",class:"invalid-feedback"})]),e("div",te,[ae,a(u,{id:"name",name:"姓名",type:"text",class:c(["form-control",{"is-invalid":i.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:t.form.user.name,"onUpdate:modelValue":o[3]||(o[3]=l=>t.form.user.name=l)},null,8,["class","modelValue"]),a(p,{name:"姓名",class:"invalid-feedback"})]),e("div",le,[re,a(u,{id:"tel",name:"電話",type:"tel",class:c(["form-control",{"is-invalid":i.電話}]),placeholder:"請輸入電話",modelValue:t.form.user.tel,"onUpdate:modelValue":o[4]||(o[4]=l=>t.form.user.tel=l),rules:m.isPhone},null,8,["class","modelValue","rules"]),a(p,{name:"電話",class:"invalid-feedback"})]),e("div",ne,[ie,a(u,{id:"address",name:"地址",type:"text",class:c(["form-control",{"is-invalid":i.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:t.form.user.address,"onUpdate:modelValue":o[5]||(o[5]=l=>t.form.user.address=l)},null,8,["class","modelValue"]),a(p,{name:"地址",class:"invalid-feedback"})]),e("div",de,[ce,b(e("textarea",{id:"message",name:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":o[6]||(o[6]=l=>t.form.message=l)},null,512),[[g,t.form.message]])]),me]),_:1},8,["onSubmit"])])):(r(),n(V,{key:2},[e("div",ue,[pe,e("a",{class:"btn btn-primary py-3 px-5 text-gray-dark",role:"button",onClick:o[7]||(o[7]=()=>s.$router.push("/products"))},"再去晃晃吧")]),a(S)],64))])])])])],64)}const Ie=P(R,[["render",fe]]);export{Ie as default};
